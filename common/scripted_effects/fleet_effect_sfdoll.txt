# 持续压制 scope = fleet
aura_sfdoll_2_effect = {
	if = {
		limit = {
			NOT = {	has_fleet_flag = aura_sfdoll_2_friendly	}
			any_owned_ship = {	has_component = component_aura_sfdoll_2	}
		}
		solar_system = {
			every_fleet_in_system = {
				if = {
					limit = {
						owner = {	is_same_value = root.owner	}
					}
					set_timed_fleet_flag = {
						flag = aura_sfdoll_2_friendly
						days = 30
					}
				}
				else_if = {
					limit = {
						NOT = {	has_fleet_flag = aura_sfdoll_2_hostile	}
						owner = {	is_hostile = root.owner	}
					}
					set_timed_fleet_flag = {
						flag = aura_sfdoll_2_hostile
						days = 30
					}
					add_modifier = {
						modifier = aura_sfdoll_2_hostile_modifier
						days = 30
					}
				}
			}
		}
	}
}

# this = ship destroyed , root = ship , root.fromfrom = ship destroyed
sfdoll_warship_rebuild = {
	if = {
		limit = { is_ship_size = sfdoll_warship_1 }
		fleet = {
			create_ship = {
				name = prev
				random_existing_design = sfdoll_warship_1
				effect = {
					set_timed_ship_flag = {
						flag = flag_sfdoll_aux_rebuild
						days = 30
					}
				}
			}
		}
	}
	else_if = {
		limit = { is_ship_size = sfdoll_warship_2 }
		fleet = {
			create_ship = {
				name = prev
				random_existing_design = sfdoll_warship_2
				effect = {
					set_timed_ship_flag = {
						flag = flag_sfdoll_aux_rebuild
						days = 30
					}
				}
			}
		}
	}
	else_if = {
		limit = { is_ship_size = sfdoll_warship_3 }
		fleet = {
			create_ship = {
				name = prev
				random_existing_design = sfdoll_warship_3
				effect = {
					set_timed_ship_flag = {
						flag = flag_sfdoll_aux_rebuild
						days = 30
					}
				}
			}
		}
	}
	else_if = {
		limit = { is_ship_size = sfdoll_warship_4 }
		fleet = {
			create_ship = {
				name = prev
				random_existing_design = sfdoll_warship_4
				effect = {
					set_timed_ship_flag = {
						flag = flag_sfdoll_aux_rebuild
						days = 30
					}
				}
			}
		}
	}
	else_if = {
		limit = { is_ship_size = sfdoll_warship_5 }
		fleet = {
			create_ship = {
				name = prev
				random_existing_design = sfdoll_warship_5
				effect = {
					set_timed_ship_flag = {
						flag = flag_sfdoll_aux_rebuild
						days = 30
					}
				}
			}
		}
	}
	else_if = {
		limit = { is_ship_size = sfdoll_warship_6 }
		fleet = {
			create_ship = {
				name = prev
				random_existing_design = sfdoll_warship_6
				effect = {
					set_timed_ship_flag = {
						flag = flag_sfdoll_aux_rebuild
						days = 30
					}
				}
			}
		}
	}
	# else_if = {
	# 	limit = {
	# 		is_ship_size = sfdoll_mobile_starbase
	# 	}
	# 	create_fleet = {
	# 		name = root.fromfrom.fleet
	# 		effect = {
	# 			set_owner = root
	# 			create_ship = {
	# 				random_existing_design = sfdoll_mobile_starbase
	# 				name = root.fromfrom
	# 				effect = {
	# 					set_timed_ship_flag = {
	# 						flag = flag_sfdoll_aux_rebuild
	# 						days = 30
	# 					}
	# 					# change_variable = {
	# 					# 	which = sfdoll_rebuild_count
	# 					# 	value = 1
	# 					# }
	# 				}
	# 			}
	# 			set_location = root.fromfrom
	# 		}
	# 		settings = {
	# 			can_upgrade = yes
	# 			uses_naval_capacity = yes
	# 			spawn_debris = no
	# 			can_disband = yes
	# 			can_change_leader = yes
	# 			can_change_composition = no
	# 		}
	# 	}
	# }

}
#剩余1舰，新建舰队进行复活
sfdoll_warship_rebuild_num1 = {
	create_fleet = {
		name = root.fromfrom.fleet
		effect = {
			set_owner = root
			set_location = root.fromfrom
			#复活的新舰队30天内不能触发
			set_timed_fleet_flag = {
				flag = flag_sfdoll_fleet_rebuild
				days = 30
			}
			if = {
				limit = {
					root.fromfrom = {
						is_ship_size = sfdoll_warship_1
					}
				}
				create_ship = {
					random_existing_design = sfdoll_warship_1
					name = root.fromfrom
					effect = {
						set_timed_ship_flag = {
							flag = flag_sfdoll_aux_rebuild
							days = 30
						}
					}
				}
			}
			else_if = {
				limit = {
					root.fromfrom = {
						is_ship_size = sfdoll_warship_2
					}
				}
				create_ship = {
					random_existing_design = sfdoll_warship_2
					name = root.fromfrom
					effect = {
						set_timed_ship_flag = {
							flag = flag_sfdoll_aux_rebuild
							days = 30
						}
					}
				}
			}
			else_if = {
				limit = {
					root.fromfrom = {
						is_ship_size = sfdoll_warship_3
					}
				}
				create_ship = {
					random_existing_design = sfdoll_warship_3
					name = root.fromfrom
					effect = {
						set_timed_ship_flag = {
							flag = flag_sfdoll_aux_rebuild
							days = 30
						}
					}
				}
			}
			else_if = {
				limit = {
					root.fromfrom = {
						is_ship_size = sfdoll_warship_4
					}
				}
				create_ship = {
					random_existing_design = sfdoll_warship_4
					name = root.fromfrom
					effect = {
						set_timed_ship_flag = {
							flag = flag_sfdoll_aux_rebuild
							days = 30
						}
					}
				}
			}
			else_if = {
				limit = {
					root.fromfrom = {
						is_ship_size = sfdoll_warship_5
					}
				}
				create_ship = {
					random_existing_design = sfdoll_warship_5
					name = root.fromfrom
					effect = {
						set_timed_ship_flag = {
							flag = flag_sfdoll_aux_rebuild
							days = 30
						}
					}
				}
			}
			else_if = {
				limit = {
					root.fromfrom = {
						is_ship_size = sfdoll_warship_6
					}
				}
				create_ship = {
					random_existing_design = sfdoll_warship_6
					name = root.fromfrom
					effect = {
						set_timed_ship_flag = {
							flag = flag_sfdoll_aux_rebuild
							days = 30
						}
					}
				}
			}
			else_if = {
				limit = {
					root.fromfrom = {
						is_ship_size = sfdoll_mobile_starbase
					}
				}
				create_ship = {
					random_existing_design = sfdoll_mobile_starbase
					name = root.fromfrom
					effect = {
						set_timed_ship_flag = {
							flag = flag_sfdoll_aux_rebuild
							days = 30
						}
					}
				}
			}
		}
	}
}

# This root = owner of fleet 1 (destroyed)
# From = owner of fleet 2 (combatant)
# FromFrom = fleet 1
# FromFromFrom = fleet 2
sfdoll_fleet_rebuild = {
	fromfrom = {
		solar_system = {
			create_fleet = {
				name = root.fromfrom.name
				effect = {
					#scope creat fleet
					set_owner = root
					root.fromfrom = {
						every_owned_ship = {
							if = {
								limit = {
									has_component = sfdoll_aux_rebuild
									NOT = {
										has_ship_flag = flag_sfdoll_aux_rebuild
									}
								}
								if = {
									limit = { is_ship_size = sfdoll_warship_1 }
									prevprev = {
										create_ship = {
											name = prev
											random_existing_design = sfdoll_warship_1
											effect = {
												set_timed_ship_flag = {
													flag = flag_sfdoll_aux_rebuild
													days = 30
												}
											}
										}
									}
								}
								else_if = {
									limit = { is_ship_size = sfdoll_warship_2 }
									prevprev = {
										create_ship = {
											name = prev
											random_existing_design = sfdoll_warship_2
											effect = {
												set_timed_ship_flag = {
													flag = flag_sfdoll_aux_rebuild
													days = 30
												}
											}
										}
									}
								}
								else_if = {
									limit = { is_ship_size = sfdoll_warship_3 }
									prevprev = {
										create_ship = {
											name = prev
											random_existing_design = sfdoll_warship_3
											effect = {
												set_timed_ship_flag = {
													flag = flag_sfdoll_aux_rebuild
													days = 30
												}
											}
										}
									}
								}
								else_if = {
									limit = { is_ship_size = sfdoll_warship_4 }
									prevprev = {
										create_ship = {
											name = prev
											random_existing_design = sfdoll_warship_4
											effect = {
												set_timed_ship_flag = {
													flag = flag_sfdoll_aux_rebuild
													days = 30
												}
											}
										}
									}
								}
								else_if = {
									limit = { is_ship_size = sfdoll_warship_5 }
									prevprev = {
										create_ship = {
											name = prev
											random_existing_design = sfdoll_warship_5
											effect = {
												set_timed_ship_flag = {
													flag = flag_sfdoll_aux_rebuild
													days = 30
												}
											}
										}
									}
								}
								else_if = {
									limit = { is_ship_size = sfdoll_warship_6 }
									prevprev = {
										create_ship = {
											name = prev
											random_existing_design = sfdoll_warship_6
											effect = {
												set_timed_ship_flag = {
													flag = flag_sfdoll_aux_rebuild
													days = 30
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
		# if = {
		# 	limit = {
		# 		any_owned_ship = {
		# 			has_component = sfdoll_aux_rebuild
		# 			NOT = {
		# 				has_ship_flag = flag_sfdoll_aux_rebuild
		# 			}
		# 		}
		# 	}
		# }
	}
}

#this = new fleet , prev = a ship destroyed , root = country , root.fromfrom = old fleet
sfdoll_warship_rebuild_2 = {
	
}

